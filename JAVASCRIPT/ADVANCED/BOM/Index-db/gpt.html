<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndexedDB Example</title>
</head>
<body>
    <input type="text" id="dbName" placeholder="Database Name">
    <input type="text" id="dbVersion" placeholder="Database Version">
    <button onclick="createDB()">Create Database</button>
    <br><br>
    <input type="text" id="title" placeholder="Title">
    <input type="text" id="author" placeholder="Author">
    <button onclick="addBooks()">Add Book</button>

    <script>
        let db;

        function createDB() {
            var dbName = document.getElementById('dbName').value;
            var dbVersion = parseInt(document.getElementById('dbVersion').value) || 1;

            var request = window.indexedDB.open(dbName, dbVersion);

            request.onerror = function(event) {
                console.log('Error: ' + event.target.errorCode);
            };

            request.onsuccess = function(event) {
                db = event.target.result;
                console.log('Database Created Successfully');
            };

            request.onupgradeneeded = function(event) {
                db = event.target.result;
                if (!db.objectStoreNames.contains('books')) {
                    // ✅ Fix: Corrected autoIncrement syntax
                    db.createObjectStore('books', { keyPath: 'id', autoIncrement: true });
                }
            };
        }

        function addBooks() {
            if (!db) {
                console.log("Database is not initialized. Please create the database first.");
                return;
            }

            const title = document.getElementById('title').value;
            const author = document.getElementById('author').value;

            let transaction = db.transaction('books', 'readwrite');
            let store = transaction.objectStore('books');

            // ✅ Fix: Remove `id` as it's auto-generated
            let data = { title, author };

            let request = store.add(data);

            request.onsuccess = function() {
                console.log('Book Added Successfully');
            };

            request.onerror = function(event) {
                console.log('Error: ' + event.target.error);
            };
        }
    </script>
</body>
</html>
